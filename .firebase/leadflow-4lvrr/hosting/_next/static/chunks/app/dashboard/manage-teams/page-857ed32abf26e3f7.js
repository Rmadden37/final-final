(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8734],{17759:(e,a,t)=>{"use strict";t.d(a,{C5:()=>j,MJ:()=>f,Rr:()=>g,eI:()=>p,lR:()=>h,lV:()=>o,zB:()=>m});var s=t(95155),r=t(12115),l=t(99708),i=t(62177),n=t(59434),d=t(85057);let o=i.Op,c=r.createContext({}),m=e=>{let{...a}=e;return(0,s.jsx)(c.Provider,{value:{name:a.name},children:(0,s.jsx)(i.xI,{...a})})},u=()=>{let e=r.useContext(c),a=r.useContext(x),{getFieldState:t,formState:s}=(0,i.xW)(),l=t(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:n}=a;return{id:n,name:e.name,formItemId:"".concat(n,"-form-item"),formDescriptionId:"".concat(n,"-form-item-description"),formMessageId:"".concat(n,"-form-item-message"),...l}},x=r.createContext({}),p=r.forwardRef((e,a)=>{let{className:t,...l}=e,i=r.useId();return(0,s.jsx)(x.Provider,{value:{id:i},children:(0,s.jsx)("div",{ref:a,className:(0,n.cn)("space-y-2",t),...l})})});p.displayName="FormItem";let h=r.forwardRef((e,a)=>{let{className:t,...r}=e,{error:l,formItemId:i}=u();return(0,s.jsx)(d.J,{ref:a,className:(0,n.cn)(l&&"text-destructive",t),htmlFor:i,...r})});h.displayName="FormLabel";let f=r.forwardRef((e,a)=>{let{...t}=e,{error:r,formItemId:i,formDescriptionId:n,formMessageId:d}=u();return(0,s.jsx)(l.DX,{ref:a,id:i,"aria-describedby":r?"".concat(n," ").concat(d):"".concat(n),"aria-invalid":!!r,...t})});f.displayName="FormControl";let g=r.forwardRef((e,a)=>{let{className:t,...r}=e,{formDescriptionId:l}=u();return(0,s.jsx)("p",{ref:a,id:l,className:(0,n.cn)("text-sm text-muted-foreground",t),...r})});g.displayName="FormDescription";let j=r.forwardRef((e,a)=>{var t;let{className:r,children:l,...i}=e,{error:d,formMessageId:o}=u(),c=d?String(null!=(t=null==d?void 0:d.message)?t:""):l;return c?(0,s.jsx)("p",{ref:a,id:o,className:(0,n.cn)("text-sm font-medium text-destructive",r),...i,children:c}):null});j.displayName="FormMessage"},44838:(e,a,t)=>{"use strict";t.d(a,{SQ:()=>u,_2:()=>x,mB:()=>p,rI:()=>c,ty:()=>m});var s=t(95155),r=t(12115),l=t(48698),i=t(73158),n=t(10518),d=t(70154),o=t(59434);let c=l.bL,m=l.l9;l.YJ,l.ZL,l.Pb,l.z6,r.forwardRef((e,a)=>{let{className:t,inset:r,children:n,...d}=e;return(0,s.jsxs)(l.ZP,{ref:a,className:(0,o.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",t),...d,children:[n,(0,s.jsx)(i.A,{className:"ml-auto"})]})}).displayName=l.ZP.displayName,r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.G5,{ref:a,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}).displayName=l.G5.displayName;let u=r.forwardRef((e,a)=>{let{className:t,sideOffset:r=4,...i}=e;return(0,s.jsx)(l.ZL,{children:(0,s.jsx)(l.UC,{ref:a,sideOffset:r,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...i})})});u.displayName=l.UC.displayName;let x=r.forwardRef((e,a)=>{let{className:t,inset:r,...i}=e;return(0,s.jsx)(l.q7,{ref:a,className:(0,o.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",t),...i})});x.displayName=l.q7.displayName,r.forwardRef((e,a)=>{let{className:t,children:r,checked:i,...d}=e;return(0,s.jsxs)(l.H_,{ref:a,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:i,...d,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(l.VF,{children:(0,s.jsx)(n.A,{className:"h-4 w-4"})})}),r]})}).displayName=l.H_.displayName,r.forwardRef((e,a)=>{let{className:t,children:r,...i}=e;return(0,s.jsxs)(l.hN,{ref:a,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...i,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(l.VF,{children:(0,s.jsx)(d.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=l.hN.displayName,r.forwardRef((e,a)=>{let{className:t,inset:r,...i}=e;return(0,s.jsx)(l.JU,{ref:a,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",t),...i})}).displayName=l.JU.displayName;let p=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.wv,{ref:a,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",t),...r})});p.displayName=l.wv.displayName},59409:(e,a,t)=>{"use strict";t.d(a,{bq:()=>u,eb:()=>f,gC:()=>h,l6:()=>c,yv:()=>m});var s=t(95155),r=t(12115),l=t(31992),i=t(79556),n=t(77381),d=t(10518),o=t(59434);let c=l.bL;l.YJ;let m=l.WT,u=r.forwardRef((e,a)=>{let{className:t,children:r,...n}=e;return(0,s.jsxs)(l.l9,{ref:a,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[r,(0,s.jsx)(l.In,{asChild:!0,children:(0,s.jsx)(i.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=l.l9.displayName;let x=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.PP,{ref:a,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,s.jsx)(n.A,{className:"h-4 w-4"})})});x.displayName=l.PP.displayName;let p=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.wn,{ref:a,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,s.jsx)(i.A,{className:"h-4 w-4"})})});p.displayName=l.wn.displayName;let h=r.forwardRef((e,a)=>{let{className:t,children:r,position:i="popper",...n}=e;return(0,s.jsx)(l.ZL,{children:(0,s.jsxs)(l.UC,{ref:a,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...n,children:[(0,s.jsx)(x,{}),(0,s.jsx)(l.LM,{className:(0,o.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,s.jsx)(p,{})]})})});h.displayName=l.UC.displayName,r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.JU,{ref:a,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r})}).displayName=l.JU.displayName;let f=r.forwardRef((e,a)=>{let{className:t,children:r,...i}=e;return(0,s.jsxs)(l.q7,{ref:a,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...i,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(l.VF,{children:(0,s.jsx)(d.A,{className:"h-4 w-4"})})}),(0,s.jsx)(l.p4,{children:r})]})});f.displayName=l.q7.displayName,r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.wv,{ref:a,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=l.wv.displayName},62523:(e,a,t)=>{"use strict";t.d(a,{p:()=>i});var s=t(95155),r=t(12115),l=t(59434);let i=r.forwardRef((e,a)=>{let{className:t,type:r,...i}=e;return(0,s.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...i})});i.displayName="Input"},66695:(e,a,t)=>{"use strict";t.d(a,{BT:()=>o,Wu:()=>c,ZB:()=>d,Zp:()=>i,aR:()=>n,wL:()=>m});var s=t(95155),r=t(12115),l=t(59434);let i=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,"data-card":"true",className:(0,l.cn)("rounded-2xl overflow-hidden border border-slate-200 bg-white text-card-foreground","shadow-lg shadow-slate-200/50 hover:shadow-xl hover:shadow-slate-300/50","transition-all duration-200 ease-in-out","mobile:rounded-xl mobile:mx-2 mobile:shadow-md","mobile:border-slate-300/50",t),...r})});i.displayName="Card";let n=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("flex flex-col space-y-1.5 p-6","mobile:p-4 mobile:space-y-1",t),...r})});n.displayName="CardHeader";let d=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("h3",{ref:a,className:(0,l.cn)("text-3xl font-bold font-headline leading-tight tracking-tight text-center","mobile:text-xl mobile:leading-snug","tablet:text-2xl",t),...r})});d.displayName="CardTitle";let o=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("p",{ref:a,className:(0,l.cn)("text-sm text-muted-foreground text-center","mobile:text-xs mobile:leading-relaxed",t),...r})});o.displayName="CardDescription";let c=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("p-6 pt-0",t),...r})});c.displayName="CardContent";let m=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)("div",{ref:a,className:(0,l.cn)("flex items-center p-6 pt-0",t),...r})});m.displayName="CardFooter"},68951:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>ei});var s=t(95155),r=t(98030),l=t(35695),i=t(12115),n=t(50172),d=t(28044),o=t(50286),c=t(66695),m=t(56104),u=t(35317),x=t(30285),p=t(62523),h=t(91394),f=t(44838),g=t(83173),j=t(75074),v=t(67933),N=t(79556),b=t(54683),y=t(77223),w=t(87481),C=t(54165),A=t(85057),k=t(59409);let R=["setter","closer","manager","admin"];function P(e){let{userToEdit:a,isOpen:t,onClose:l,managerTeamId:d}=e,{user:o}=(0,r.A)(),{toast:c}=(0,w.dj)(),[p,h]=(0,i.useState)(a.role),[f,g]=(0,i.useState)(!1);(0,i.useEffect)(()=>{t&&h(a.role)},[t,a.role]);let j=async()=>{if(!p)return void c({title:"No Role Selected",description:"Please select a new role.",variant:"destructive"});if(!o||"manager"!==o.role&&"admin"!==o.role)return void c({title:"Unauthorized",description:"Only managers and admins can change roles.",variant:"destructive"});if(a.uid===o.uid)return void c({title:"Action Not Allowed",description:"You cannot change your own role here.",variant:"destructive"});if("manager"===a.role&&"manager"!==p&&"admin"!==o.role)return void c({title:"Action Not Allowed",description:"Only admins can demote managers.",variant:"destructive"});if("admin"===a.role&&"admin"!==p&&"admin"!==o.role)return void c({title:"Action Not Allowed",description:"Only admins can change admin roles.",variant:"destructive"});g(!0);let e=(0,u.wP)(m.db),t=(0,u.doc)(m.db,"users",a.uid);e.update(t,{role:p});let s="closer"===a.role||"manager"===a.role||"admin"===a.role,r="closer"===p||"manager"===p||"admin"===p;if(r&&!s){let t=(0,u.doc)(m.db,"closers",a.uid);e.set(t,{uid:a.uid,name:a.displayName||a.email||"Unknown User",teamId:a.teamId,status:"Off Duty",role:p,avatarUrl:a.avatarUrl||null,phone:null,lineupOrder:new Date().getTime(),createdAt:(0,u.serverTimestamp)(),updatedAt:(0,u.serverTimestamp)()})}else if(s&&!r){let t=(0,u.doc)(m.db,"closers",a.uid);e.delete(t)}else if(s&&r&&a.role!==p){let t=(0,u.doc)(m.db,"closers",a.uid);e.update(t,{role:p,updatedAt:(0,u.serverTimestamp)()})}try{await e.commit(),c({title:"Role Updated",description:"".concat(a.displayName||a.email,"'s role changed to ").concat(p,".")}),l()}catch(e){c({title:"Update Failed",description:"Could not update user role. Please try again.",variant:"destructive"})}finally{g(!1)}};return t?(0,s.jsx)(C.lG,{open:t,onOpenChange:l,children:(0,s.jsxs)(C.Cf,{className:"sm:max-w-md",children:[(0,s.jsxs)(C.c7,{children:[(0,s.jsxs)(C.L3,{className:"font-headline",children:["Change Role for ",a.displayName||a.email]}),(0,s.jsx)(C.rr,{children:"Select the new role for this user. This will affect their permissions and access."})]}),(0,s.jsx)("div",{className:"grid gap-4 py-4",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(A.J,{htmlFor:"role-select",children:"New Role"}),(0,s.jsxs)(k.l6,{value:p,onValueChange:e=>h(e),children:[(0,s.jsx)(k.bq,{id:"role-select",className:"w-full",children:(0,s.jsx)(k.yv,{placeholder:"Select a role"})}),(0,s.jsx)(k.gC,{children:R.map(e=>(0,s.jsx)(k.eb,{value:e,className:"capitalize",children:e},e))})]})]})}),(0,s.jsxs)(C.Es,{children:[(0,s.jsx)(C.HM,{asChild:!0,children:(0,s.jsx)(x.$,{variant:"outline",onClick:l,disabled:f,children:"Cancel"})}),(0,s.jsx)(x.$,{onClick:j,disabled:f||!p||p===a.role,children:f?(0,s.jsx)(n.A,{className:"mr-2 h-5 w-5 animate-spin"}):"Save Changes"})]})]})}):null}var U=t(17649),F=t(59434);let I=U.bL;U.l9;let S=U.ZL,E=i.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(U.hJ,{className:(0,F.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r,ref:a})});E.displayName=U.hJ.displayName;let T=i.forwardRef((e,a)=>{let{className:t,...r}=e;return i.useEffect(()=>{let e="dialog-scroll-locked",a=window.__openDialogCount||0;if(a++,window.__openDialogCount=a,1===a){document.body.classList.add(e),document.body.style.overflow="hidden";let a=window.innerWidth-document.documentElement.clientWidth;a>0&&(document.body.style.paddingRight="".concat(a,"px"))}return()=>{let a=window.__openDialogCount||1;a=Math.max(0,a-1),window.__openDialogCount=a,0===a&&(document.body.classList.remove(e),document.body.style.overflow="",document.body.style.paddingRight="")}},[]),(0,s.jsxs)(S,{children:[(0,s.jsx)(E,{}),(0,s.jsx)(U.UC,{ref:a,className:(0,F.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r})]})});T.displayName=U.UC.displayName;let z=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,F.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...t})};z.displayName="AlertDialogHeader";let D=e=>{let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,F.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...t})};D.displayName="AlertDialogFooter";let q=i.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(U.hE,{ref:a,className:(0,F.cn)("text-lg font-semibold",t),...r})});q.displayName=U.hE.displayName;let _=i.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(U.VY,{ref:a,className:(0,F.cn)("text-sm text-muted-foreground",t),...r})});_.displayName=U.VY.displayName;let L=i.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(U.rc,{ref:a,className:(0,F.cn)((0,x.r)(),t),...r})});L.displayName=U.rc.displayName;let M=i.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(U.ZD,{ref:a,className:(0,F.cn)((0,x.r)({variant:"outline"}),"mt-2 sm:mt-0",t),...r})});function B(e){let{userToDelete:a,isOpen:t,onClose:r,onConfirmDelete:l}=e,[o,c]=(0,i.useState)(!1),m=async()=>{c(!0),await l(),c(!1)};return t?(0,s.jsx)(I,{open:t,onOpenChange:r,children:(0,s.jsxs)(T,{children:[(0,s.jsxs)(z,{children:[(0,s.jsx)(q,{className:"font-headline",children:"Confirm User Deletion"}),(0,s.jsxs)(_,{children:["Are you sure you want to delete the user: ",(0,s.jsx)("strong",{children:a.displayName||a.email}),"? This action will remove their records from the application. This action cannot be undone."]})]}),(0,s.jsxs)("div",{className:"my-4 p-3 bg-destructive/10 border border-destructive/30 rounded-md text-sm text-destructive flex items-start",children:[(0,s.jsx)(d.A,{className:"h-5 w-5 mr-2 mt-0.5 flex-shrink-0"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Warning:"})," This will delete the user's data from Firestore (user profile, closer record if applicable). However, it will ",(0,s.jsx)("strong",{children:"not"})," delete their Firebase Authentication account. Full account deletion requires backend admin privileges."]})]}),(0,s.jsxs)(D,{children:[(0,s.jsx)(M,{onClick:r,disabled:o,children:"Cancel"}),(0,s.jsx)(L,{onClick:m,disabled:o,className:"bg-destructive hover:bg-destructive/90",children:o?(0,s.jsx)(n.A,{className:"mr-2 h-4 w-4 animate-spin"}):"Yes, Delete User Records"})]})]})}):null}M.displayName=U.ZD.displayName;var J=t(90858),O=t(93004),Z=t(16923),V=t(25318),Y=t(93576);function W(e){let{isOpen:a,onClose:t,user:l}=e,{user:d}=(0,r.A)(),{toast:o}=(0,w.dj)(),[c,p]=(0,i.useState)(null),[f,g]=(0,i.useState)(null),[j,N]=(0,i.useState)(!1),[b,y]=(0,i.useState)(0),[A,k]=(0,i.useState)(!1),R=async()=>{if(c&&d){if("manager"!==d.role&&"admin"!==d.role)return void o({title:"Unauthorized",description:"Only managers and admins can upload user photos.",variant:"destructive"});N(!0),y(0);try{let e=Date.now(),a=c.name.split(".").pop(),t="avatars/".concat(l.uid,"_").concat(e,".").concat(a),s=(0,J.KR)(m.IG,t),r=(0,J.bp)(s,c);r.on("state_changed",e=>{let a=e.bytesTransferred/e.totalBytes*100;y(a)},e=>{console.error("Upload error:",e),o({title:"Upload Failed",description:"Failed to upload image. Please try again.",variant:"destructive"}),N(!1)},async()=>{try{let e=await (0,J.qk)(r.snapshot.ref),a=(0,u.doc)(m.db,"users",l.uid);if(await (0,u.updateDoc)(a,{avatarUrl:e,updatedAt:new Date}),"closer"===l.role||"manager"===l.role||"admin"===l.role){let a=(0,u.doc)(m.db,"closers",l.uid);await (0,u.updateDoc)(a,{avatarUrl:e,updatedAt:new Date})}o({title:"Photo Updated",description:"".concat(l.displayName||l.email,"'s profile photo has been updated.")}),P()}catch(e){console.error("Error updating user:",e),o({title:"Update Failed",description:"Photo uploaded but failed to update user profile.",variant:"destructive"})}finally{N(!1)}})}catch(e){console.error("Upload error:",e),o({title:"Upload Failed",description:"Failed to upload image. Please try again.",variant:"destructive"}),N(!1)}}},P=()=>{j||A||(p(null),g(null),y(0),t())},U=async()=>{if(!l.email)return void o({title:"Error",description:"Email address not found for this user.",variant:"destructive"});k(!0);try{await (0,O.J1)(m.j2,l.email),o({title:"Password Reset Email Sent",description:"Password reset email sent to ".concat(l.email,". They will need to check their inbox.")})}catch(e){console.error("Password reset error:",e),o({title:"Reset Failed",description:"Could not send password reset email. Please try again.",variant:"destructive"})}finally{k(!1)}},F=(null==d?void 0:d.role)==="manager"||(null==d?void 0:d.role)==="admin";return(0,s.jsx)(C.lG,{open:a,onOpenChange:e=>{e||j||A||P()},children:(0,s.jsxs)(C.Cf,{className:"sm:max-w-md",children:[(0,s.jsxs)(C.c7,{children:[(0,s.jsxs)(C.L3,{className:"font-headline flex items-center",children:[(0,s.jsx)(v.A,{className:"mr-2 h-5 w-5 text-primary"}),"Update Profile Photo"]}),(0,s.jsxs)(C.rr,{children:["Upload a new profile photo for ",l.displayName||l.email]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"Current Photo:"}),(0,s.jsxs)(h.eu,{className:"h-20 w-20",children:[(0,s.jsx)(h.BK,{src:l.avatarUrl||void 0,alt:l.displayName||l.email||"User"}),(0,s.jsx)(h.q5,{className:"text-lg",children:l.displayName?l.displayName.substring(0,2).toUpperCase():l.email?l.email.substring(0,2).toUpperCase():"??"})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:"Select New Photo:"}),(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var a;let t=null==(a=e.target.files)?void 0:a[0];return t?t.type.startsWith("image/")?t.size>5242880?void o({title:"File Too Large",description:"Please select an image smaller than 5MB.",variant:"destructive"}):void(p(t),g(URL.createObjectURL(t))):void o({title:"Invalid File",description:"Please select an image file.",variant:"destructive"}):void 0},disabled:!F||j,className:"hidden",id:"avatar-upload"}),(0,s.jsxs)("label",{htmlFor:"avatar-upload",className:"cursor-pointer border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center transition-colors hover:border-gray-400 dark:hover:border-gray-500 ".concat(!F||j?"opacity-50 cursor-not-allowed":""),children:[(0,s.jsx)(Z.A,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),(0,s.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Click to select an image"}),(0,s.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:"Max 5MB • JPG, PNG, GIF"})]}),f&&(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(h.eu,{className:"h-20 w-20",children:(0,s.jsx)(h.BK,{src:f,alt:"Preview"})}),!j&&(0,s.jsx)("button",{onClick:()=>{p(null),g(null)},className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600",children:(0,s.jsx)(V.A,{className:"h-3 w-3"})})]})]})]}),j&&(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{children:"Uploading..."}),(0,s.jsxs)("span",{children:[Math.round(b),"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(b,"%")}})})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsx)(x.$,{variant:"outline",onClick:P,disabled:j||A,className:"flex-1",children:"Cancel"}),(0,s.jsx)(x.$,{onClick:R,disabled:!c||j||A||!F,className:"flex-1",children:j?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Uploading..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Z.A,{className:"mr-2 h-4 w-4"}),"Upload Photo"]})})]}),F&&l.email&&(0,s.jsxs)("div",{className:"border-t pt-3",children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground mb-2",children:"Account Management:"}),(0,s.jsx)(x.$,{variant:"outline",onClick:U,disabled:j||A,className:"w-full",children:A?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Sending Reset Email..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Y.A,{className:"mr-2 h-4 w-4"}),"Send Password Reset Email"]})})]})]}),!F&&(0,s.jsx)("div",{className:"text-xs text-orange-600 dark:text-orange-400 bg-orange-50 dark:bg-orange-950/50 px-3 py-2 rounded-md",children:"Only managers and admins can upload user photos."})]})]})})}let $=[{id:"empire",name:"Empire",description:"Elite sales team for enterprise-level opportunities",regionId:"default",isActive:!0,settings:{autoAssignment:!0,maxLeadsPerCloser:12,workingHours:{start:"07:00",end:"22:00",timezone:"America/Los_Angeles"}}}];async function G(){console.log("Initializing teams collection...");try{let e=(0,u.collection)(m.db,"teams"),a=await (0,u.getDocs)(e),t=new Set(a.docs.map(e=>e.id));console.log("Found ".concat(a.size," existing teams: ").concat(Array.from(t).join(", ")));let s=$.filter(e=>!t.has(e.id)).map(async a=>{let t=(0,u.doc)(e,a.id),s={...a,createdAt:new Date,updatedAt:new Date};await (0,u.setDoc)(t,s),console.log("Created team: ".concat(a.name," (").concat(a.id,")"))});0===s.length?console.log("All default teams already exist. No action needed."):(await Promise.all(s),console.log("Created ".concat(s.length," new teams. Teams initialization completed successfully!")))}catch(e){throw console.error("Error initializing teams:",e),e}}var H=t(45731);function Q(){let{user:e}=(0,r.A)(),{toast:a}=(0,w.dj)(),[t,l]=(0,i.useState)([]),[d,c]=(0,i.useState)(!0),[x,p]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=(0,u.query)((0,u.collection)(m.db,"teams")),t=(0,u.aQ)(e,e=>{l(e.docs.map(e=>({id:e.id,...e.data()}))),c(!1)},e=>{a({title:"Error",description:"Failed to load teams. Please refresh the page.",variant:"destructive"}),c(!1)});return()=>t()},[a]),(0,i.useEffect)(()=>{(async()=>{if(!d&&0===t.length&&((null==e?void 0:e.role)==="manager"||(null==e?void 0:e.role)==="admin"))try{await G(),a({title:"Teams Initialized",description:"Empire team has been created successfully."})}catch(e){a({title:"Error",description:"Failed to initialize teams.",variant:"destructive"})}})()},[d,t.length,null==e?void 0:e.role,a]);let h=async s=>{if(e&&s&&s!==e.teamId){p(!0);try{let r=(0,u.doc)(m.db,"users",e.uid);if(await (0,u.updateDoc)(r,{teamId:s,updatedAt:(0,u.serverTimestamp)()}),"closer"===e.role){let a=(0,u.doc)(m.db,"closers",e.uid);await (0,u.updateDoc)(a,{teamId:s,updatedAt:(0,u.serverTimestamp)()})}let l=t.find(e=>e.id===s);a({title:"Team Switched",description:"Successfully switched to ".concat((null==l?void 0:l.name)||"new team",".")})}catch(e){a({title:"Switch Failed",description:"Failed to switch teams. Please try again.",variant:"destructive"})}finally{p(!1)}}};if(!e||"setter"===e.role)return null;let f=t.find(a=>a.id===(null==e?void 0:e.teamId));return(0,s.jsx)("div",{className:"w-full max-w-md",children:(0,s.jsxs)("div",{className:"space-y-2",children:[d?(0,s.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,s.jsx)(n.A,{className:"h-5 w-5 animate-spin mr-2 dark:text-turquoise premium:text-white"}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground dark:text-gray-400 premium:text-gray-300",children:"Loading teams..."})]}):(0,s.jsxs)(k.l6,{value:e.teamId,onValueChange:h,disabled:x,children:[(0,s.jsx)(k.bq,{className:"w-full dark:card-glass dark:border-turquoise/20 dark:glow-turquoise premium:card-glass premium:border-white/18 premium:text-glow",children:(0,s.jsx)(k.yv,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(g.A,{className:"h-4 w-4 text-primary dark:text-turquoise premium:text-white"}),(0,s.jsx)("span",{className:"font-medium dark:text-gray-200 premium:text-white",children:(null==f?void 0:f.name)||"Unknown Team"}),(null==f?void 0:f.description)&&(0,s.jsxs)("span",{className:"text-xs text-muted-foreground dark:text-gray-400 premium:text-gray-300",children:["- ",f.description]})]})})}),(0,s.jsx)(k.gC,{className:"dark:card-glass dark:border-turquoise/20 dark:glow-turquoise premium:card-glass premium:border-white/18",children:t.filter(e=>e.isActive).map(e=>(0,s.jsx)(k.eb,{value:e.id,className:"dark:hover:bg-turquoise/10 dark:focus:bg-turquoise/10 premium:hover:bg-white/10 premium:focus:bg-white/10 premium:text-white",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(g.A,{className:"h-4 w-4 dark:text-cyan premium:text-gray-300"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium dark:text-gray-200 premium:text-white",children:e.name}),e.description&&(0,s.jsx)("div",{className:"text-xs text-muted-foreground dark:text-gray-400 premium:text-gray-300",children:e.description})]})]})},e.id))})]}),x&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground premium:text-gray-300",children:[(0,s.jsx)(n.A,{className:"h-4 w-4 animate-spin premium:text-white"}),"Switching teams..."]}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground p-2 bg-muted/50 rounded border premium:bg-white/10 premium:border-white/20 premium:text-gray-300",children:(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("span",{children:[(0,s.jsx)("strong",{className:"premium:text-white",children:"Role:"}),(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 ml-1",children:[("manager"===e.role||"admin"===e.role)&&(0,s.jsx)(H.A,{className:"h-3 w-3 text-blue-600 premium:text-blue-400"}),"closer"===e.role&&(0,s.jsx)(o.A,{className:"h-3 w-3 text-green-600 premium:text-green-400"}),(0,s.jsx)("span",{className:"capitalize font-medium premium:text-white",children:e.role})]})]})})})]})})}var K=t(17759),X=t(13896),ee=t(62177),ea=t(90221),et=t(71153);let es=et.Ik({email:et.Yj().email("Please enter a valid email address"),displayName:et.Yj().min(2,"Name must be at least 2 characters").optional().or(et.eu("")),phoneNumber:et.Yj().min(10,"Please enter a valid phone number").optional().or(et.eu("")),tempPassword:et.Yj().min(6,"Password must be at least 6 characters"),role:et.k5(["setter","closer","manager"],{required_error:"Please select a role"}),teamId:et.Yj().min(1,"Please select a team")});function er(e){let{className:a="",size:t="sm",variant:l="primary-solid"}=e,[d,o]=(0,i.useState)(!1),[c,h]=(0,i.useState)(!1),[f,j]=(0,i.useState)([]),[v,N]=(0,i.useState)(!0),{toast:b}=(0,w.dj)(),{user:y}=(0,r.A)();(0,i.useEffect)(()=>{let e=(0,u.query)((0,u.collection)(m.db,"teams")),a=(0,u.aQ)(e,e=>{j(e.docs.map(e=>({id:e.id,...e.data()})).filter(e=>e.isActive)),N(!1)},e=>{console.error("Error loading teams:",e),b({title:"Error",description:"Failed to load teams.",variant:"destructive"}),N(!1)});return()=>a()},[b]);let A=(0,ee.mN)({resolver:(0,ea.u)(es),defaultValues:{email:"",displayName:"",phoneNumber:"",tempPassword:"",role:void 0,teamId:(null==y?void 0:y.teamId)||""}}),R=()=>{c||(A.reset(),o(!1))},P=async e=>{var a,t,s;h(!0),console.log("Submitting invite user form with data:",{email:e.email,displayName:e.displayName,phoneNumber:e.phoneNumber,role:e.role,tempPasswordLength:null==(a=e.tempPassword)?void 0:a.length});try{if(!e.email.trim())throw Error("Email address is required");if(!e.tempPassword.trim())throw Error("Temporary password is required");if(!e.role)throw Error("Role selection is required");console.log("Calling inviteUserFunction...");let a=await (0,m.V$)({email:e.email.trim(),displayName:(null==(t=e.displayName)?void 0:t.trim())||void 0,phoneNumber:(null==(s=e.phoneNumber)?void 0:s.trim())||void 0,tempPassword:e.tempPassword,role:e.role,teamId:e.teamId});console.log("inviteUserFunction result:",a);let r=a.data;if(null==r?void 0:r.success)b({title:"Invitation Sent! ✉️",description:r.message||"User invitation sent successfully",duration:5e3}),R();else throw Error("Invitation failed")}catch(a){console.error("Invite user error:",a);let e="Failed to send invitation. Please try again.";(null==a?void 0:a.code)==="functions/already-exists"?e="This user is already a member of your team.":(null==a?void 0:a.code)==="functions/failed-precondition"?e=a.message||"User is already a member of another team.":(null==a?void 0:a.code)==="functions/invalid-argument"?e=a.message||"Invalid invitation data provided.":(null==a?void 0:a.code)==="functions/permission-denied"?e="You don't have permission to invite users.":(null==a?void 0:a.code)==="functions/unauthenticated"?e="Authentication required. Please log in and try again.":(null==a?void 0:a.code)==="functions/not-found"?e="User profile not found. Please contact support.":(null==a?void 0:a.code)==="functions/internal"?e=a.message||"Internal server error. Please try again.":(null==a?void 0:a.code)==="functions/unavailable"?e="Service temporarily unavailable. Please try again later.":(null==a?void 0:a.message)&&(e=a.message),b({title:"Invitation Failed",description:e,variant:"destructive",duration:6e3})}finally{h(!1)}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(x.$,{onClick:()=>o(!0),variant:l,size:t,className:a,children:[(0,s.jsx)(X.A,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5"}),(0,s.jsx)("span",{className:"hidden md:inline",children:"Invite New User"}),(0,s.jsx)("span",{className:"md:hidden",children:"Invite"})]}),(0,s.jsx)(C.lG,{open:d,onOpenChange:R,children:(0,s.jsxs)(C.Cf,{className:"sm:max-w-[500px]",children:[(0,s.jsxs)(C.c7,{children:[(0,s.jsxs)(C.L3,{className:"flex items-center gap-2",children:[(0,s.jsx)(X.A,{className:"h-5 w-5 text-primary"}),"Invite New Team Member"]}),(0,s.jsx)(C.rr,{children:"Send an invitation to add a new member to your team. They will receive their login credentials and can start using the system immediately."})]}),(0,s.jsx)(K.lV,{...A,children:(0,s.jsxs)("form",{onSubmit:A.handleSubmit(P),className:"space-y-6",children:[(0,s.jsx)(K.zB,{control:A.control,name:"email",render:e=>{let{field:a}=e;return(0,s.jsxs)(K.eI,{children:[(0,s.jsx)(K.lR,{children:"Email Address *"}),(0,s.jsx)(K.MJ,{children:(0,s.jsx)(p.p,{placeholder:"user@company.com",type:"email",...a,disabled:c})}),(0,s.jsx)(K.C5,{})]})}}),(0,s.jsx)(K.zB,{control:A.control,name:"displayName",render:e=>{let{field:a}=e;return(0,s.jsxs)(K.eI,{children:[(0,s.jsx)(K.lR,{children:"Display Name"}),(0,s.jsx)(K.MJ,{children:(0,s.jsx)(p.p,{placeholder:"John Doe (optional)",...a,disabled:c})}),(0,s.jsx)(K.C5,{})]})}}),(0,s.jsx)(K.zB,{control:A.control,name:"phoneNumber",render:e=>{let{field:a}=e;return(0,s.jsxs)(K.eI,{children:[(0,s.jsx)(K.lR,{children:"Phone Number"}),(0,s.jsx)(K.MJ,{children:(0,s.jsx)(p.p,{placeholder:"(555) 123-4567 (optional)",type:"tel",...a,disabled:c})}),(0,s.jsx)(K.C5,{})]})}}),(0,s.jsx)(K.zB,{control:A.control,name:"tempPassword",render:e=>{let{field:a}=e;return(0,s.jsxs)(K.eI,{children:[(0,s.jsx)(K.lR,{children:"Temporary Password *"}),(0,s.jsx)(K.MJ,{children:(0,s.jsx)(p.p,{placeholder:"Enter temporary password",type:"password",...a,disabled:c})}),(0,s.jsx)(K.C5,{}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Minimum 6 characters. User will be able to change this password after first login."})]})}}),(0,s.jsx)(K.zB,{control:A.control,name:"role",render:e=>{let{field:a}=e;return(0,s.jsxs)(K.eI,{children:[(0,s.jsx)(K.lR,{children:"Role *"}),(0,s.jsxs)(k.l6,{onValueChange:a.onChange,value:a.value,disabled:c,children:[(0,s.jsx)(K.MJ,{children:(0,s.jsx)(k.bq,{children:(0,s.jsx)(k.yv,{placeholder:"Select a role for this user"})})}),(0,s.jsxs)(k.gC,{children:[(0,s.jsx)(k.eb,{value:"setter",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-medium",children:"Setter"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Can create and manage leads"})]})}),(0,s.jsx)(k.eb,{value:"closer",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-medium",children:"Closer"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Can accept and process assigned leads"})]})}),(0,s.jsx)(k.eb,{value:"manager",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-medium",children:"Manager"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Full access to team management"})]})})]})]}),(0,s.jsx)(K.C5,{})]})}}),(0,s.jsx)(K.zB,{control:A.control,name:"teamId",render:e=>{let{field:a}=e;return(0,s.jsxs)(K.eI,{children:[(0,s.jsx)(K.lR,{children:"Team *"}),(0,s.jsxs)(k.l6,{onValueChange:a.onChange,value:a.value,disabled:c||v,children:[(0,s.jsx)(K.MJ,{children:(0,s.jsx)(k.bq,{children:(0,s.jsx)(k.yv,{placeholder:"Select a team"})})}),(0,s.jsx)(k.gC,{children:f.map(e=>(0,s.jsx)(k.eb,{value:e.id,children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(g.A,{className:"h-4 w-4"}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-medium",children:e.name}),e.description&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:e.description})]})]})},e.id))})]}),(0,s.jsx)(K.C5,{}),v&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,s.jsx)(n.A,{className:"h-3 w-3 animate-spin"}),"Loading teams..."]})]})}}),(0,s.jsxs)(C.Es,{className:"flex flex-col-reverse sm:flex-row gap-2",children:[(0,s.jsx)(x.$,{type:"button",variant:"outline",onClick:R,disabled:c,className:"w-full sm:w-auto",children:"Cancel"}),(0,s.jsx)(x.$,{type:"submit",disabled:c,className:"w-full sm:w-auto",children:c?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Sending Invitation..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(X.A,{className:"mr-2 h-4 w-4"}),"Send Invitation"]})})]})]})})]})})]})}function el(){let{user:e}=(0,r.A)(),{toast:a}=(0,w.dj)(),[t,l]=(0,i.useState)([]),[d,C]=(0,i.useState)([]),[A,k]=(0,i.useState)(!0),[R,U]=(0,i.useState)(""),[F,I]=(0,i.useState)(""),[S,E]=(0,i.useState)(""),[T,z]=(0,i.useState)(null),[D,q]=(0,i.useState)(null),[_,L]=(0,i.useState)(null);(0,i.useEffect)(()=>{let t=(0,u.query)((0,u.collection)(m.db,"teams")),s=(0,u.aQ)(t,a=>{let t=a.docs.map(e=>({id:e.id,...e.data()}));C(t),((null==e?void 0:e.role)==="manager"||(null==e?void 0:e.role)==="admin")&&(t.some(e=>"empire"===e.id)||G().catch(()=>{}))},e=>{a({title:"Error",description:"Failed to load teams.",variant:"destructive"})});return()=>s()},[a,e]),(0,i.useEffect)(()=>{if((null==e?void 0:e.role)==="manager"||(null==e?void 0:e.role)==="admin"){k(!0);let e=(0,u.query)((0,u.collection)(m.db,"users")),t=(0,u.aQ)(e,e=>{let a=e.docs.map(e=>({uid:e.id,...e.data()}));a.sort((e,a)=>{let t=e.displayName||e.email||"",s=a.displayName||a.email||"";return t.localeCompare(s)}),l(a),k(!1)},e=>{a({title:"Error",description:"Could not fetch team users.",variant:"destructive"}),k(!1)});return()=>t()}k(!1),l([])},[e,a]);let M=async t=>{if(!e||"manager"!==e.role&&"admin"!==e.role)return void a({title:"Unauthorized",description:"Only managers and admins can delete users.",variant:"destructive"});if(t.uid===e.uid)return void a({title:"Action Not Allowed",description:"You cannot delete yourself.",variant:"destructive"});let s=(0,u.wP)(m.db),r=(0,u.doc)(m.db,"users",t.uid);if(s.delete(r),"closer"===t.role||"manager"===t.role||"admin"===t.role){let e=(0,u.doc)(m.db,"closers",t.uid);s.delete(e)}try{await s.commit(),a({title:"User Records Deleted",description:"".concat(t.displayName||t.email,"'s records have been removed from the application. Note: Full Firebase Authentication account deletion requires backend admin privileges."),duration:7e3}),q(null)}catch(e){a({title:"Deletion Failed",description:"Could not delete user records. Please try again.",variant:"destructive"})}};if(A)return(0,s.jsxs)(c.Zp,{className:"shadow-xl",children:[(0,s.jsxs)(c.aR,{children:[(0,s.jsxs)(c.ZB,{className:"text-2xl font-bold font-headline flex items-center justify-center",children:[(0,s.jsx)(o.A,{className:"mr-3 h-7 w-7 text-primary"}),"Team Management"]}),(0,s.jsx)(c.BT,{className:"text-center",children:"Loading team members..."})]}),(0,s.jsx)(c.Wu,{className:"flex justify-center items-center h-32",children:(0,s.jsx)(n.A,{className:"h-8 w-8 animate-spin text-primary"})})]});if(!e||"manager"!==e.role&&"admin"!==e.role)return null;let J=t.filter(e=>{var a;let t=R.toLowerCase(),s=(e.displayName||"").toLowerCase(),r=(e.email||"").toLowerCase(),l=(e.role||"").toLowerCase(),i=((null==(a=d.find(a=>a.id===e.teamId))?void 0:a.name)||"").toLowerCase(),n=""===t||s.includes(t)||r.includes(t)||l.includes(t)||i.includes(t),o=!F||e.role===F,c=!S||e.teamId===S;return n&&o&&c});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(g.A,{className:"h-6 w-6 text-primary"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold font-headline",children:"Current Team"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Select the team you want to manage"})]})]}),(0,s.jsx)(Q,{}),(0,s.jsx)("div",{className:"flex justify-start",children:(0,s.jsx)(er,{variant:"primary-solid",className:"invite-user-prominent-btn border-2 border-blue-600 bg-gradient-to-r from-blue-500 to-blue-700 text-white font-bold shadow-lg hover:from-blue-600 hover:to-blue-800 hover:shadow-xl focus:ring-4 focus:ring-blue-400 dark:from-blue-900 dark:to-blue-700 dark:text-blue-100 dark:hover:from-blue-800 dark:hover:to-blue-900 dark:focus:ring-blue-800 transition-all duration-300 rounded-xl px-6 py-3 text-base"})})]}),(0,s.jsxs)(c.Zp,{className:"shadow-xl",children:[(0,s.jsx)(c.aR,{children:(0,s.jsxs)("div",{className:"flex flex-col space-y-3 sm:flex-row sm:items-center sm:justify-between sm:space-y-0",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(o.A,{className:"mr-3 h-7 w-7 text-primary"}),(0,s.jsxs)("div",{children:[(0,s.jsx)(c.ZB,{className:"text-2xl font-bold font-headline",children:"Team Management"}),(0,s.jsx)(c.BT,{children:"Manage roles, teams, and access for your team members."})]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3 w-full sm:w-auto",children:[(0,s.jsxs)("div",{className:"relative w-full sm:w-48",children:[(0,s.jsx)(j.A,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(p.p,{type:"search",placeholder:"Search by name, email, role or team...",className:"w-full pl-9 bg-background",value:R,onChange:e=>U(e.target.value),"aria-label":"Search team members"})]}),(0,s.jsxs)("select",{className:"border rounded px-2 py-1 text-sm bg-background",value:F,onChange:e=>I(e.target.value),"aria-label":"Filter by role",children:[(0,s.jsx)("option",{value:"",children:"All Roles"}),(0,s.jsx)("option",{value:"admin",children:"Admin"}),(0,s.jsx)("option",{value:"manager",children:"Manager"}),(0,s.jsx)("option",{value:"closer",children:"Closer"}),(0,s.jsx)("option",{value:"user",children:"User"})]}),(0,s.jsxs)("select",{className:"border rounded px-2 py-1 text-sm bg-background",value:S,onChange:e=>E(e.target.value),"aria-label":"Filter by team",children:[(0,s.jsx)("option",{value:"",children:"All Teams"}),d.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]})}),(0,s.jsx)(c.Wu,{className:"space-y-4",children:0===J.length?(0,s.jsx)("p",{className:"text-muted-foreground text-center py-4",children:""!==R.trim()?"No matching team members found.":"No team members found."}):(0,s.jsx)("ul",{className:"divide-y divide-border team-member-list",children:J.map(a=>{var t;return(0,s.jsxs)("li",{className:"py-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 w-full ".concat(a.uid===(null==e?void 0:e.uid)?"bg-blue-50 dark:bg-blue-900/20 rounded-lg px-3":""),children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsxs)(h.eu,{className:"h-10 w-10 border cursor-pointer transition-all duration-200 hover:ring-2 hover:ring-primary hover:ring-offset-2 ".concat(a.uid===(null==e?void 0:e.uid)?"ring-2 ring-primary ring-offset-2":""),onClick:()=>L(a),tabIndex:0,"aria-label":"Edit avatar for ".concat(a.displayName||a.email),children:[(0,s.jsx)(h.BK,{src:a.avatarUrl||void 0,alt:a.displayName||a.email||"User"}),(0,s.jsx)(h.q5,{children:a.displayName?a.displayName.substring(0,2).toUpperCase():a.email?a.email.substring(0,2).toUpperCase():"??"})]}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 cursor-pointer",onClick:()=>L(a),children:(0,s.jsx)(v.A,{className:"h-4 w-4 text-white"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("p",{className:"font-semibold",children:a.displayName||a.email||"Unnamed User"}),a.uid===(null==e?void 0:e.uid)&&(0,s.jsx)("span",{className:"ml-2 px-1.5 py-0.5 text-xs rounded-md bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100",children:"You"})]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:a.email}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 mt-1",children:[(0,s.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ".concat("admin"===a.role?"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200":"manager"===a.role?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"closer"===a.role?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200"),children:a.role}),(0,s.jsxs)("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-slate-100 text-slate-800 dark:bg-slate-900 dark:text-slate-200",children:[(0,s.jsx)(g.A,{className:"mr-1 h-3 w-3"}),(null==(t=d.find(e=>e.id===a.teamId))?void 0:t.name)||"Unknown"]})]})]})]}),(0,s.jsx)("div",{className:"flex flex-col xs:flex-row gap-2 w-full xs:w-auto team-management-actions",children:(0,s.jsxs)(f.rI,{children:[(0,s.jsx)(f.ty,{asChild:!0,children:(0,s.jsxs)(x.$,{variant:"outline",size:"sm","aria-label":"User actions",children:["Actions ",(0,s.jsx)(N.A,{className:"ml-1.5 h-4 w-4"})]})}),(0,s.jsxs)(f.SQ,{align:"end",children:[(0,s.jsxs)(f._2,{onClick:()=>z(a),"aria-label":"Change role",children:[(0,s.jsx)(b.A,{className:"mr-2 h-4 w-4"})," Change Role"]}),(0,s.jsxs)(f._2,{onClick:()=>q(a),disabled:"manager"===a.role||"admin"===a.role||a.uid===(null==e?void 0:e.uid),"aria-label":"Delete user",children:[(0,s.jsx)(y.A,{className:"mr-2 h-4 w-4"})," Delete"]}),(0,s.jsx)(f._2,{asChild:!0,disabled:!0,children:(0,s.jsxs)("span",{className:"flex items-center text-xs text-muted-foreground",children:[(0,s.jsx)(g.A,{className:"mr-2 h-4 w-4"}),"Change Team (use badge above)"]})})]})]})})]},a.uid)})})})]})]}),T&&(0,s.jsx)(P,{userToEdit:T,isOpen:!!T,onClose:()=>z(null),managerTeamId:e.teamId}),D&&(0,s.jsx)(B,{userToDelete:D,isOpen:!!D,onClose:()=>q(null),onConfirmDelete:()=>M(D)}),_&&(0,s.jsx)(W,{user:_,isOpen:!!_,onClose:()=>L(null)})]})}function ei(){let{user:e,loading:a}=(0,r.A)(),t=(0,l.useRouter)();return((0,i.useEffect)(()=>{!a&&e&&"manager"!==e.role&&"admin"!==e.role&&t.replace("/dashboard")},[e,a,t]),a)?(0,s.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,s.jsx)(n.A,{className:"h-10 w-10 animate-spin text-primary"})}):e&&("manager"===e.role||"admin"===e.role)?(0,s.jsxs)("div",{className:"container py-10 space-y-6",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[(0,s.jsx)(o.A,{className:"h-8 w-8 text-primary"}),"Manage Teams"]}),(0,s.jsx)("p",{className:"text-muted-foreground mt-2",children:"Manage team members, roles, and assignments"})]})}),(0,s.jsxs)(c.Zp,{children:[(0,s.jsxs)(c.aR,{children:[(0,s.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(o.A,{className:"h-5 w-5 text-primary"}),"Team Management"]}),(0,s.jsx)(c.BT,{children:"View and manage your team members, assign roles, and control access permissions"})]}),(0,s.jsx)(c.Wu,{children:(0,s.jsx)(el,{})})]})]}):(0,s.jsx)("div",{className:"container py-10",children:(0,s.jsx)(c.Zp,{children:(0,s.jsxs)(c.Wu,{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,s.jsx)(d.A,{className:"h-16 w-16 text-destructive mb-4"}),(0,s.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Access Restricted"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"You do not have permission to access team management. Manager or admin access required."})]})})})}},78010:(e,a,t)=>{Promise.resolve().then(t.bind(t,68951))},85057:(e,a,t)=>{"use strict";t.d(a,{J:()=>o});var s=t(95155),r=t(12115),l=t(40968),i=t(74466),n=t(59434);let d=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.b,{ref:a,className:(0,n.cn)(d(),t),...r})});o.displayName=l.b.displayName},91394:(e,a,t)=>{"use strict";t.d(a,{BK:()=>d,eu:()=>n,q5:()=>o});var s=t(95155),r=t(12115),l=t(54011),i=t(59434);let n=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.bL,{ref:a,className:(0,i.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...r})});n.displayName=l.bL.displayName;let d=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l._V,{ref:a,className:(0,i.cn)("aspect-square h-full w-full",t),...r})});d.displayName=l._V.displayName;let o=r.forwardRef((e,a)=>{let{className:t,...r}=e;return(0,s.jsx)(l.H4,{ref:a,className:(0,i.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...r})});o.displayName=l.H4.displayName}},e=>{var a=a=>e(e.s=a);e.O(0,[2992,3644,4763,4277,5296,9233,9196,4547,1859,861,8782,6095,2508,8622,8441,1684,7358],()=>a(78010)),_N_E=e.O()}]);