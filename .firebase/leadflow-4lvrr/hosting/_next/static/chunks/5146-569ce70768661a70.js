"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5146],{22715:(e,s,a)=>{a.d(s,{A:()=>Q});var t=a(95155),l=a(66695),r=a(30285),i=a(19677),n=a(58127),d=a(24371),o=a(76603),c=a(763),m=a(6160),u=a(35079),x=a(91721),h=a(73926),f=a(31554),p=a(19637),g=a(89829),v=a(37648),N=a(83662),b=a(79311),w=a(98030),j=a(12115),y=a(35317),k=a(50172),A=a(87481),C=a(56104),S=a(59434),L=a(53282),_=a(54165),D=a(30356),R=a(85057),E=a(88539),T=a(59409),U=a(99297),F=a(26133);let P=["sold","no_sale","canceled","rescheduled","credit_fail","waiting_assignment"],z=(()=>{let e=[];for(let s=8;s<=22;s++){let a=s>12?s-12:0===s?12:s,t=s>=12?"PM":"AM";e.push({value:"".concat(s.toString().padStart(2,"0"),":00"),label:"".concat(a,":00 ").concat(t)}),s<22&&e.push({value:"".concat(s.toString().padStart(2,"0"),":30"),label:"".concat(a,":30 ").concat(t)})}return e})();function q(e){let{lead:s,isOpen:a,onClose:l}=e,{toast:i}=(0,A.dj)(),{user:n}=(0,w.A)(),[d,o]=(0,j.useState)(void 0),[c,m]=(0,j.useState)(""),[u,x]=(0,j.useState)(!1),[h,f]=(0,j.useState)(void 0),[p,g]=(0,j.useState)("17:00"),[v,N]=(0,j.useState)([]),[b,q]=(0,j.useState)(void 0),[V,M]=(0,j.useState)(!1);(0,j.useEffect)(()=>{a&&(o(void 0),m(""),f(void 0),g("17:00"),q(void 0),N([]))},[a,s.id]);let O=(0,j.useMemo)(()=>(null==n?void 0:n.role)==="manager"||(null==n?void 0:n.role)==="admin"?P:P.filter(e=>"waiting_assignment"!==e),[null==n?void 0:n.role]),{teamId:I,role:$}=null!=n?n:{},{assignedCloserId:B}=s;(0,j.useEffect)(()=>{if("waiting_assignment"===d&&I&&("manager"===$||"admin"===$)){M(!0);let e=(0,y.query)((0,y.collection)(C.db,"closers"),(0,y.where)("teamId","==",I),(0,y.where)("status","==","On Duty")),s=(0,y.aQ)(e,e=>{N(e.docs.map(e=>({uid:e.id,...e.data()})).filter(e=>e.uid!==B).sort((e,s)=>{var a,t;return(null!=(a=e.lineupOrder)?a:999)-(null!=(t=s.lineupOrder)?t:999)||e.name.localeCompare(s.name)})),M(!1)},e=>{console.error("Error loading available closers:",e),i({title:"Error Loading Closers",description:"Could not load closers.",variant:"destructive"}),M(!1)});return()=>s()}N([]),q(void 0)},[d,I,$,B,i]);let Z=async()=>{let e;if(!d)return void i({title:"No Status Selected",description:"Please select a disposition status.",variant:"destructive"});if("waiting_assignment"===d&&((null==n?void 0:n.role)==="manager"||(null==n?void 0:n.role)==="admin")&&v.length,"rescheduled"===d){if(!h)return void i({title:"Missing Appointment Date",description:"Please select a date for the appointment.",variant:"destructive"});let[s,a]=p.split(":").map(Number),t=new Date(h);if(t.setHours(s,a,0,0),t<=new Date)return void i({title:"Invalid Appointment Time",description:"Appointment must be in the future.",variant:"destructive"});e=y.Dc.fromDate(t)}x(!0);try{let a,t=(0,y.doc)(C.db,"leads",s.id),r={status:d,dispositionNotes:c,updatedAt:(0,y.serverTimestamp)(),scheduledAppointmentTime:"rescheduled"===d&&e?e:null};if("waiting_assignment"===d&&((null==n?void 0:n.role)==="manager"||(null==n?void 0:n.role)==="admin"))if(b){let e=v.find(e=>e.uid===b);e&&(r.assignedCloserId=e.uid,r.assignedCloserName=e.name,a=e)}else r.assignedCloserId=null,r.assignedCloserName=null;await (0,y.updateDoc)(t,r),a&&await L.t0.leadAssigned({...s,...r,id:s.id},a.uid);let o=a?"Lead reassigned to ".concat(a.name,"."):"Lead marked as ".concat(d.replace("_"," "),".");i({title:"Disposition Updated",description:o}),l()}catch(e){console.error("Failed to update disposition: ",e),i({title:"Update Failed",description:"Could not update lead disposition.",variant:"destructive"})}finally{x(!1)}};return(0,t.jsx)(_.lG,{open:a,onOpenChange:e=>!e&&l(),children:(0,t.jsxs)(_.Cf,{className:"max-w-full sm:max-w-md p-2 sm:p-6 overflow-x-hidden",children:[(0,t.jsxs)(_.c7,{children:[(0,t.jsx)(_.L3,{className:"font-headline",children:(null==n?void 0:n.role)==="manager"||(null==n?void 0:n.role)==="admin"?"Manager Disposition":"Update Lead Disposition"}),(0,t.jsx)(_.rr,{children:(null==n?void 0:n.role)==="manager"||(null==n?void 0:n.role)==="admin"?"Set the status for lead: ".concat(s.customerName,". As a manager/admin, you can set any disposition or reassign the lead."):"Select the outcome for lead: ".concat(s.customerName,".")})]}),(0,t.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,t.jsx)(D.z,{onValueChange:e=>o(e),value:d,className:"w-full",children:O.map(e=>(0,t.jsxs)("div",{className:(0,S.cn)("flex items-center space-x-2 rounded-md p-2","waiting_assignment"===e&&((null==n?void 0:n.role)==="manager"||(null==n?void 0:n.role)==="admin")?"bg-amber-50 border border-amber-200 dark:bg-amber-950/20 dark:border-amber-800/30":""),children:[(0,t.jsx)(D.C,{value:e,id:"status-".concat(e)}),(0,t.jsx)(R.J,{htmlFor:"status-".concat(e),className:"capitalize flex-1",children:"waiting_assignment"===e&&((null==n?void 0:n.role)==="manager"||(null==n?void 0:n.role)==="admin")?(0,t.jsx)("span",{className:"font-medium text-amber-700 dark:text-amber-300",children:"Reassign Closer"}):e.replace("_"," ")})]},e))}),"waiting_assignment"===d&&((null==n?void 0:n.role)==="manager"||(null==n?void 0:n.role)==="admin")&&(0,t.jsxs)("div",{className:"space-y-3 rounded-md border border-amber-200 bg-amber-50 dark:bg-amber-950/20 dark:border-amber-800/30 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"h-2 w-2 rounded-full bg-amber-500"}),(0,t.jsx)(R.J,{className:"text-sm font-medium text-amber-700 dark:text-amber-300",children:"Reassign to Available Closer"})]}),V?(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(k.A,{className:"h-4 w-4 animate-spin"}),(0,t.jsx)("span",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Loading available closers..."})]}):v.length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"Select a closer to reassign this lead to, or leave unselected to move to general assignment queue."}),(0,t.jsxs)(T.l6,{onValueChange:q,value:b,children:[(0,t.jsx)(T.bq,{className:"w-full max-w-full",children:(0,t.jsx)(T.yv,{placeholder:"Select a closer (or leave blank for general queue)"})}),(0,t.jsx)(T.gC,{className:"max-w-full",children:v.map(e=>(0,t.jsx)(T.eb,{value:e.uid,className:"truncate max-w-full",children:e.name},e.uid))})]})]}):(0,t.jsx)("p",{className:"text-sm text-amber-600 dark:text-amber-400",children:"No available closers found. This will move the lead to the general assignment queue."})]}),"rescheduled"===d&&(0,t.jsxs)("div",{className:"space-y-3 rounded-md border border-border p-3",children:[(0,t.jsx)(R.J,{className:"text-sm font-medium",children:"Set Appointment Time"}),(0,t.jsx)(U.l,{date:h,onDateChange:f,placeholder:"Pick a date",className:"w-full max-w-full"}),(0,t.jsx)("div",{className:"w-full max-w-full",children:(0,t.jsx)(F.A,{time:p,onTimeChange:g,placeholder:"Select time",timeSlots:z,className:"w-full max-w-full"})})]}),(0,t.jsx)("div",{style:{minHeight:24},children:(0,t.jsx)(E.T,{placeholder:"Add any relevant notes...",value:c,onChange:e=>m(e.target.value),rows:3})})]}),(0,t.jsxs)(_.Es,{children:[(0,t.jsx)(r.$,{variant:"outline",onClick:l,disabled:u,children:"Cancel"}),(0,t.jsx)(r.$,{onClick:Z,disabled:u||!d,children:u?(0,t.jsx)(k.A,{className:"mr-2 h-5 w-5 animate-spin"}):"Save Disposition"})]})]})})}var V=a(26126),M=a(12543),O=a(19968),I=a(61840),$=a(68718),B=a(25318);function Z(e){let{photoUrls:s,customerName:a,isOpen:l,onClose:i}=e,[n,d]=(0,j.useState)(0),[o,c]=(0,j.useState)(!1),[m,u]=(0,j.useState)(!0),{toast:x}=(0,A.dj)(),h=async(e,s)=>{c(!0);try{let t=await fetch(e,{mode:"cors",credentials:"same-origin",headers:{Accept:"image/*"}});if(!t.ok)if(403===t.status)throw Error("Access denied - insufficient permissions");else if(404===t.status)throw Error("Image not found");else throw Error("Failed to fetch image (".concat(t.status,")"));let l=await t.blob(),r="".concat(a.replace(/\s+/g,"_"),"_photo_").concat(s+1,".jpg");{let e=window.URL.createObjectURL(l),s=document.createElement("a");s.href=e,s.download=r,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(e)}x({title:"Download Complete",description:"Photo ".concat(s+1," has been downloaded.")})}catch(e){console.error("Download failed:",e),x({title:"Download Failed",description:e instanceof Error?e.message:"Unable to download the photo. Please try again.",variant:"destructive"})}finally{c(!1)}},f=async()=>{c(!0);try{for(let e=0;e<s.length;e++)await h(s[e],e),e<s.length-1&&await new Promise(e=>setTimeout(e,500));x({title:"All Downloads Complete",description:"".concat(s.length," photos have been downloaded.")})}catch(e){console.error("Download all failed:",e),x({title:"Download Failed",description:"Some photos may not have downloaded. Please try again.",variant:"destructive"})}finally{c(!1)}},p=e=>{window.open(e,"_blank","noopener,noreferrer")};return s&&0!==s.length?(0,t.jsx)(_.lG,{open:l,onOpenChange:i,children:(0,t.jsxs)(_.Cf,{className:"max-w-4xl max-h-[90vh] p-0",children:[(0,t.jsx)(_.c7,{className:"p-6 pb-0",children:(0,t.jsxs)(_.L3,{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(b.A,{className:"h-5 w-5"}),"Photos for ",a]}),(0,t.jsxs)(V.E,{variant:"secondary",className:"text-xs",children:[n+1," of ",s.length]})]})}),(0,t.jsxs)("div",{className:"relative flex-1 min-h-[400px] max-h-[60vh] bg-black/5 dark:bg-black/20 mx-6",children:[(0,t.jsxs)("div",{className:"relative w-full h-full flex items-center justify-center",children:[m&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)(k.A,{className:"h-8 w-8 animate-spin text-muted-foreground"})}),(0,t.jsx)("img",{src:s[n],alt:"Photo ".concat(n+1," for ").concat(a),className:"max-w-full max-h-full object-contain rounded-lg",onLoad:()=>{u(!1)},onError:()=>{u(!1),x({title:"Image Load Error",description:"Unable to load this image.",variant:"destructive"})},style:{display:m?"none":"block"}})]}),s.length>1&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.$,{variant:"outline",size:"icon",className:"absolute left-2 top-1/2 transform -translate-y-1/2 bg-white/90 dark:bg-black/90 hover:bg-white dark:hover:bg-black",onClick:()=>{d(e=>0===e?s.length-1:e-1),u(!0)},disabled:m,children:(0,t.jsx)(M.A,{className:"h-4 w-4"})}),(0,t.jsx)(r.$,{variant:"outline",size:"icon",className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-white/90 dark:bg-black/90 hover:bg-white dark:hover:bg-black",onClick:()=>{d(e=>e===s.length-1?0:e+1),u(!0)},disabled:m,children:(0,t.jsx)(O.A,{className:"h-4 w-4"})})]})]}),s.length>1&&(0,t.jsx)("div",{className:"px-6 py-4 border-t",children:(0,t.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2",children:s.map((e,s)=>(0,t.jsx)("button",{onClick:()=>{d(s),u(!0)},className:"flex-shrink-0 w-16 h-16 rounded-md overflow-hidden border-2 transition-all ".concat(s===n?"border-primary ring-2 ring-primary/20":"border-border hover:border-primary/50"),children:(0,t.jsx)("img",{src:e,alt:"Thumbnail ".concat(s+1),className:"w-full h-full object-cover"})},s))})}),(0,t.jsxs)(_.Es,{className:"p-6 pt-0 flex flex-col sm:flex-row gap-2",children:[(0,t.jsxs)("div",{className:"flex gap-2 flex-1",children:[(0,t.jsxs)(r.$,{variant:"outline",size:"sm",onClick:()=>p(s[n]),className:"flex items-center gap-2",children:[(0,t.jsx)(I.A,{className:"h-4 w-4"}),"Open in New Tab"]}),(0,t.jsxs)(r.$,{variant:"outline",size:"sm",onClick:()=>h(s[n],n),disabled:o,className:"flex items-center gap-2",children:[o?(0,t.jsx)(k.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)($.A,{className:"h-4 w-4"}),"Download This Photo"]}),s.length>1&&(0,t.jsxs)(r.$,{variant:"outline",size:"sm",onClick:f,disabled:o,className:"flex items-center gap-2",children:[o?(0,t.jsx)(k.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)($.A,{className:"h-4 w-4"}),"Download All (",s.length,")"]})]}),(0,t.jsxs)(r.$,{variant:"outline",onClick:i,size:"sm",children:[(0,t.jsx)(B.A,{className:"h-4 w-4 mr-2"}),"Close"]})]})]})}):null}var J=a(76430),G=a(35714),H=a(83013);let W=e=>{switch(e){case"in_process":return(0,t.jsx)(i.A,{className:"h-4 w-4 text-white stroke-2 premium:icon-glow-white",fill:"none",stroke:"currentColor",strokeWidth:2});case"accepted":return(0,t.jsx)(n.A,{className:"h-4 w-4 text-green-600"});case"sold":return(0,t.jsx)(n.A,{className:"h-4 w-4 text-green-500"});case"no_sale":return(0,t.jsx)(d.A,{className:"h-4 w-4 text-red-500"});case"canceled":return(0,t.jsx)(o.A,{className:"h-4 w-4 text-yellow-500"});case"rescheduled":return(0,t.jsx)(c.A,{className:"h-4 w-4 text-purple-500"});case"scheduled":return(0,t.jsx)(c.A,{className:"h-4 w-4 text-blue-500"});case"credit_fail":return(0,t.jsx)(m.A,{className:"h-4 w-4 text-blue-500"});case"waiting_assignment":return(0,t.jsx)(u.A,{className:"h-4 w-4 text-gray-500"});default:return null}},K=e=>{switch(e){case"sold":return"default";case"accepted":case"in_process":return"secondary";case"no_sale":case"credit_fail":case"canceled":return"destructive";default:return"outline"}};function Q(e){let{lead:s,context:a="in-process",onLeadClick:i}=e,{user:n}=(0,w.A)(),[d,o]=(0,j.useState)(!1),[c,m]=(0,j.useState)(!1),u=(null==n?void 0:n.role)==="closer"&&("in_process"===s.status||"accepted"===s.status)||((null==n?void 0:n.role)==="manager"||(null==n?void 0:n.role)==="admin")&&("all-leads"===a||"in-process"===a||"queue-scheduled"===a),y=s.createdAt?(0,G.m)(s.createdAt.toDate(),{addSuffix:!0}):"N/A",k=("rescheduled"===s.status||"scheduled"===s.status)&&s.scheduledAppointmentTime?(0,H.GP)(s.scheduledAppointmentTime.toDate(),"MMM d, p"):null;return"queue-scheduled"===a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(l.Zp,{className:"shadow-md hover:shadow-lg transition-shadow duration-200 flex flex-col dark:card-glass dark:glow-turquoise dark:border-turquoise/20 ".concat(u?"cursor-pointer hover:dark:glow-cyan":""),onClick:u?()=>{console.log("\uD83D\uDD25 LeadCard - Card clicked for lead details:",{leadId:s.id,customerName:s.customerName,context:a,userRole:null==n?void 0:n.role}),null==i||i(s)}:void 0,children:[(0,t.jsx)(l.aR,{className:"pb-2 pt-3 px-3 sm:pb-3 sm:pt-4 sm:px-4",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex items-center flex-1 min-w-0",children:[(0,t.jsx)(x.A,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5 text-primary flex-shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)(l.ZB,{className:"text-sm sm:text-base font-semibold font-headline text-left truncate",children:s.customerName}),(0,t.jsxs)(l.BT,{className:"text-xs text-muted-foreground text-left",children:[s.setterName&&(0,t.jsxs)("span",{className:"truncate",children:["Set by: ",s.setterName]}),"rescheduled"===s.status&&s.assignedCloserName&&(0,t.jsxs)("span",{className:"ml-2 text-blue-600 font-bold truncate",children:["• Assigned: ",s.assignedCloserName]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2 ml-2 flex-shrink-0",children:[(0,t.jsx)(J.A,{leadId:s.id,className:"text-xs"}),"rescheduled"!==s.status&&(0,t.jsxs)(V.E,{variant:K(s.status),className:"capitalize text-xs flex items-center gap-1 whitespace-nowrap",children:[W(s.status),(0,t.jsx)("span",{className:"hidden sm:inline",children:s.status.replace("_"," ")})]})]})]})}),"            ",u&&(0,t.jsx)(l.wL,{className:"pt-0 pb-2 px-3 sm:pb-3 sm:px-4",children:(0,t.jsxs)(r.$,{onClick:e=>{console.log("\uD83D\uDD25 LeadCard - Update status button clicked:",{leadId:s.id,customerName:s.customerName,context:a,userRole:null==n?void 0:n.role}),e.stopPropagation(),o(!0)},size:"sm",variant:"secondary",className:"w-full text-xs sm:text-sm dark:card-glass dark:glow-cyan dark:hover:glow-turquoise transition-all duration-300",children:[(0,t.jsx)(h.A,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),"Update Status"]})})]}),u&&(0,t.jsx)(q,{lead:s,isOpen:d,onClose:()=>o(!1)})]}):"queue-waiting"===a?(0,t.jsx)(l.Zp,{className:"shadow-md hover:shadow-lg transition-shadow duration-200 flex flex-col dark:card-glass dark:glow-cyan dark:border-white/[.08]",children:(0,t.jsx)(l.aR,{className:"pb-2 pt-3 px-3 sm:pb-3 sm:pt-4 sm:px-4",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex items-center flex-1 min-w-0",children:[(0,t.jsx)(x.A,{className:"mr-2 h-4 w-4 sm:h-5 sm:w-5 text-primary flex-shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)(l.ZB,{className:"text-sm sm:text-base font-semibold font-headline text-left truncate",children:s.customerName}),(0,t.jsx)(l.BT,{className:"text-xs text-muted-foreground text-left",children:s.setterName&&(0,t.jsxs)("span",{className:"truncate",children:["Set by: ",s.setterName]})})]})]}),"rescheduled"!==s.status&&(0,t.jsxs)(V.E,{variant:K(s.status),className:"capitalize text-xs flex items-center gap-1 whitespace-nowrap ml-2 flex-shrink-0",children:[W(s.status),(0,t.jsx)("span",{className:"hidden sm:inline",children:s.status.replace("_"," ")})]})]})})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(l.Zp,{className:"shadow-md hover:shadow-lg transition-shadow duration-200 flex flex-col dark:card-glass dark:glow-cyan dark:border-white/[.08]",children:[(0,t.jsx)(l.aR,{className:"pb-3 pt-4 px-4",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(x.A,{className:"mr-2 h-5 w-5 text-primary flex-shrink-0"}),(0,t.jsxs)("div",{children:[(0,t.jsx)(l.ZB,{className:"text-base font-semibold font-headline text-left",children:s.customerName}),(0,t.jsxs)(l.BT,{className:"text-xs text-muted-foreground text-left",children:["Created ",y]})]})]}),"rescheduled"!==s.status&&(0,t.jsxs)(V.E,{variant:K(s.status),className:"capitalize text-xs flex items-center gap-1 whitespace-nowrap ml-2",children:[W(s.status),s.status.replace("_"," ")]})]})}),(0,t.jsxs)(l.Wu,{className:"text-sm space-y-1.5 pb-3 px-4 flex-grow",children:[(0,t.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,t.jsx)(f.A,{className:"mr-2 h-4 w-4 flex-shrink-0"}),(0,t.jsx)("span",{children:s.customerPhone})]}),s.address&&(0,t.jsxs)("div",{className:"flex items-start text-muted-foreground",children:[(0,t.jsx)(p.A,{className:"mr-2 h-4 w-4 flex-shrink-0 mt-0.5"}),(0,t.jsx)("span",{className:"truncate",title:s.address,children:s.address})]}),(0,t.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,t.jsx)(g.A,{className:"mr-2 h-4 w-4 flex-shrink-0"}),(0,t.jsxs)("span",{className:"capitalize",children:[s.dispatchType," Dispatch"]})]}),s.assignedCloserName&&"in_process"===s.status&&(0,t.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,t.jsx)(x.A,{className:"mr-2 h-4 w-4 flex-shrink-0"}),(0,t.jsxs)("span",{children:["Assigned: ",s.assignedCloserName]})]}),s.assignedCloserName&&"rescheduled"===s.status&&(0,t.jsxs)("div",{className:"flex items-center text-blue-600",children:[(0,t.jsx)(x.A,{className:"mr-2 h-4 w-4 flex-shrink-0"}),(0,t.jsxs)("span",{className:"font-bold",children:["Assigned: ",s.assignedCloserName]})]}),k&&(0,t.jsxs)("div",{className:"flex items-center text-blue-600",children:[(0,t.jsx)(v.A,{className:"mr-2 h-4 w-4 flex-shrink-0"}),(0,t.jsxs)("span",{className:"font-bold",children:["Scheduled: ",k]})]}),((null==n?void 0:n.role)==="manager"||(null==n?void 0:n.role)==="admin")&&s.setterName&&(0,t.jsxs)("div",{className:"flex items-center text-muted-foreground text-xs mt-1",children:[(0,t.jsx)(x.A,{className:"mr-2 h-3 w-3 text-gray-400 flex-shrink-0"}),(0,t.jsxs)("span",{children:["Set by: ",s.setterName]})]}),((null==n?void 0:n.role)==="manager"||(null==n?void 0:n.role)==="admin")&&s.setterLocation&&(0,t.jsxs)("div",{className:"flex items-center text-muted-foreground text-xs mt-1",children:[(0,t.jsx)(N.A,{className:"mr-2 h-3 w-3 text-gray-400 flex-shrink-0"}),(0,t.jsxs)("span",{children:["Loc: ",s.setterLocation.latitude.toFixed(2),", ",s.setterLocation.longitude.toFixed(2)," ",(0,t.jsx)("a",{href:"https://www.google.com/maps?q=".concat(s.setterLocation.latitude,",").concat(s.setterLocation.longitude),target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline","aria-label":"View location on map",children:"(Map)"})]})]}),s.photoUrls&&s.photoUrls.length>0&&(0,t.jsxs)("div",{className:"flex items-center text-muted-foreground text-xs mt-1",children:[(0,t.jsx)(b.A,{className:"mr-2 h-3 w-3 text-gray-400 flex-shrink-0"}),(0,t.jsxs)("button",{onClick:()=>{var e;console.log("\uD83D\uDD25 LeadCard - Photo gallery clicked:",{leadId:s.id,customerName:s.customerName,photoCount:(null==(e=s.photoUrls)?void 0:e.length)||0,userRole:null==n?void 0:n.role}),m(!0)},className:"text-primary hover:underline cursor-pointer",children:[s.photoUrls.length," photo(s) attached - Click to view"]})]})]}),u&&(0,t.jsx)(l.wL,{className:"pt-0 pb-3 px-4",children:(0,t.jsx)(r.$,{onClick:()=>{console.log("\uD83D\uDD25 LeadCard - Disposition modal trigger clicked:",{leadId:s.id,customerName:s.customerName,context:a,userRole:null==n?void 0:n.role}),o(!0)},size:"sm",variant:"secondary",className:"w-full dark:card-glass dark:glow-cyan dark:hover:glow-turquoise transition-all duration-300",children:(0,t.jsx)(h.A,{className:"h-4 w-4"})})})]}),u&&(0,t.jsx)(q,{lead:s,isOpen:d,onClose:()=>o(!1)}),s.photoUrls&&s.photoUrls.length>0&&(0,t.jsx)(Z,{photoUrls:s.photoUrls,customerName:s.customerName,isOpen:c,onClose:()=>m(!1)})]})}},26126:(e,s,a)=>{a.d(s,{E:()=>n});var t=a(95155);a(12115);var l=a(74466),r=a(59434);let i=(0,l.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function n(e){let{className:s,variant:a,...l}=e;return(0,t.jsx)("div",{className:(0,r.cn)(i({variant:a}),s),...l})}},66424:(e,s,a)=>{a.d(s,{F:()=>n});var t=a(95155),l=a(12115),r=a(47655),i=a(59434);let n=l.forwardRef((e,s)=>{let{className:a,children:l,...n}=e;return(0,t.jsxs)(r.bL,{ref:s,className:(0,i.cn)("relative overflow-hidden",a),...n,children:[(0,t.jsx)(r.LM,{className:"h-full w-full rounded-[inherit]",children:l}),(0,t.jsx)(d,{}),(0,t.jsx)(r.OK,{})]})});n.displayName=r.bL.displayName;let d=l.forwardRef((e,s)=>{let{className:a,orientation:l="vertical",...n}=e;return(0,t.jsx)(r.VM,{ref:s,orientation:l,className:(0,i.cn)("flex touch-none select-none transition-colors","vertical"===l&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===l&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...n,children:(0,t.jsx)(r.lr,{className:"relative flex-1 rounded-full bg-border"})})});d.displayName=r.VM.displayName},66695:(e,s,a)=>{a.d(s,{BT:()=>o,Wu:()=>c,ZB:()=>d,Zp:()=>i,aR:()=>n,wL:()=>m});var t=a(95155),l=a(12115),r=a(59434);let i=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("div",{ref:s,"data-card":"true",className:(0,r.cn)("rounded-2xl overflow-hidden border border-slate-200 bg-white text-card-foreground","shadow-lg shadow-slate-200/50 hover:shadow-xl hover:shadow-slate-300/50","transition-all duration-200 ease-in-out","mobile:rounded-xl mobile:mx-2 mobile:shadow-md","mobile:border-slate-300/50",a),...l})});i.displayName="Card";let n=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,r.cn)("flex flex-col space-y-1.5 p-6","mobile:p-4 mobile:space-y-1",a),...l})});n.displayName="CardHeader";let d=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("h3",{ref:s,className:(0,r.cn)("text-3xl font-bold font-headline leading-tight tracking-tight text-center","mobile:text-xl mobile:leading-snug","tablet:text-2xl",a),...l})});d.displayName="CardTitle";let o=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("p",{ref:s,className:(0,r.cn)("text-sm text-muted-foreground text-center","mobile:text-xs mobile:leading-relaxed",a),...l})});o.displayName="CardDescription";let c=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,r.cn)("p-6 pt-0",a),...l})});c.displayName="CardContent";let m=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("div",{ref:s,className:(0,r.cn)("flex items-center p-6 pt-0",a),...l})});m.displayName="CardFooter"},76430:(e,s,a)=>{a.d(s,{A:()=>p});var t=a(95155),l=a(12115),r=a(35317),i=a(56104),n=a(76981),d=a(10518),o=a(59434);let c=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(n.bL,{ref:s,className:(0,o.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...l,children:(0,t.jsx)(n.C1,{className:(0,o.cn)("flex items-center justify-center text-current"),children:(0,t.jsx)(d.A,{className:"h-4 w-4"})})})});c.displayName=n.bL.displayName;var m=a(85057),u=a(50172),x=a(8376),h=a(24371),f=a(87481);function p(e){let{leadId:s,disabled:a=!1,className:n=""}=e,[d,o]=(0,l.useState)(!1),[p,g]=(0,l.useState)(!0),[v,N]=(0,l.useState)(!1),{toast:b}=(0,f.dj)();(0,l.useEffect)(()=>{(async()=>{try{let e=(0,r.doc)(i.db,"leads",s),a=await (0,r.getDoc)(e);if(a.exists()){let e=a.data();o(e.isVerified||e.setterVerified||!1)}g(!1)}catch(e){console.error("Error fetching verification status:",e),b({title:"Error",description:"Failed to load verification status",variant:"destructive"}),g(!1)}})()},[s,b]);let w=async e=>{if(!a)try{N(!0),o(e),await (0,r.updateDoc)((0,r.doc)(i.db,"leads",s),{isVerified:e,setterVerified:e,verifiedAt:e?new Date:null,updatedAt:new Date}),b({title:e?"Lead Verified":"Lead Unverified",description:e?"Lead is now verified and can be assigned to closers":"Lead verification removed",variant:e?"default":"destructive"})}catch(s){console.error("Error updating verification status:",s),o(!e),b({title:"Update Failed",description:"Failed to update verification status. Please try again.",variant:"destructive"})}finally{N(!1)}};return p?(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(u.A,{className:"h-4 w-4 animate-spin text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading..."})]}):(0,t.jsxs)("div",{className:"flex items-center space-x-2 ".concat(n),children:[(0,t.jsx)(c,{id:"verified-".concat(s),checked:d,onCheckedChange:w,disabled:a||v,className:"data-[state=checked]:bg-green-600 data-[state=checked]:border-green-600"}),(0,t.jsxs)(m.J,{htmlFor:"verified-".concat(s),className:"cursor-pointer text-sm flex items-center gap-1 ".concat(a?"opacity-50 cursor-not-allowed":""),children:[v?(0,t.jsx)(u.A,{className:"h-3 w-3 animate-spin"}):d?(0,t.jsx)(x.A,{className:"h-3 w-3 text-green-600"}):(0,t.jsx)(h.A,{className:"h-3 w-3 text-red-500"}),(0,t.jsx)("span",{className:d?"text-green-600 font-medium":"text-red-500",children:d?"Verified":"Not Verified"})]})]})}},85057:(e,s,a)=>{a.d(s,{J:()=>o});var t=a(95155),l=a(12115),r=a(40968),i=a(74466),n=a(59434);let d=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)(r.b,{ref:s,className:(0,n.cn)(d(),a),...l})});o.displayName=r.b.displayName},88539:(e,s,a)=>{a.d(s,{T:()=>i});var t=a(95155),l=a(12115),r=a(59434);let i=l.forwardRef((e,s)=>{let{className:a,...l}=e;return(0,t.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:s,...l})});i.displayName="Textarea"}}]);